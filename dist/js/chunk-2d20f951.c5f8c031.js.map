{"version":3,"sources":["webpack:///./src/views/app/dashboard/Graph.vue?2ba8","webpack:///src/views/app/dashboard/Graph.vue","webpack:///./src/views/app/dashboard/Graph.vue?b22d","webpack:///./src/views/app/dashboard/Graph.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","tfs","width","height","period","on","on_selected","ref","chart","overlays","symbol","staticRenderFns","name","components","props","symbolName","type","String","default","symbolPeriod","Number","apiKey","apiSecret","data","Object","values","timer","tf","wk","wss","token","secret","binance","methods","findNearestCandle","time","candle","counter","step","watch","newVal","console","log","rerender","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,mBAAmB,CAACE,MAAM,CAAC,OAASN,EAAIO,IAAI,MAAQP,EAAIQ,MAAM,OAASR,EAAIS,OAAO,OAAST,EAAIU,QAAQC,GAAG,CAAC,SAAWX,EAAIY,eAAeR,EAAG,cAAc,CAACS,IAAI,aAAaP,MAAM,CAAC,KAAON,EAAIc,MAAM,SAAWd,EAAIe,SAAS,MAAQf,EAAIQ,MAAM,OAASR,EAAIS,OAAO,YAAYT,EAAIgB,OAAO,SAAU,EAAK,GAAKhB,EAAIU,WAAW,IACraO,EAAkB,G,mLCYtB,GACEC,KAAM,QACNC,WAAY,CAAd,gBACEC,MAAO,CACLC,WAAY,CACVC,KAAMC,OACNC,QAAN,WAEIC,aAAc,CACZH,KAAMC,OACNC,QAAN,MAEIhB,MAAO,CACLc,KAAMI,OACNF,QAAN,KAEIf,OAAQ,CACNa,KAAMI,OACNF,QAAN,KAEIG,OAAQ,CACNL,KAAMC,QAERK,UAAW,CACTN,KAAMC,SAGV,QA3BF,WA2BA,oLAGEM,KA9BF,WA+BI,MAAO,CACLd,SAAUe,OAAOC,OAAO,EAA9B,GACMC,MAAO,GACPhB,OAAQf,KAAKoB,WACbX,OAAQT,KAAKwB,aACblB,IAAK,CAAX,kDACMO,MAAO,IAAI,EAAjB,aACQA,MAAO,CACLmB,GAAI,KACJJ,KAAM,MAGVK,GAAI,EACJC,IAAK,GACLC,MAAOnC,KAAK0B,OACZU,OAAQpC,KAAK2B,UACbU,QAAS,IAAI,EAAnB,GACQX,OAAQ1B,KAAKmC,MACbR,UAAW3B,KAAKoC,WAItBE,QAAS,CACP,YADJ,SACA,kKACA,gBACA,+BAFA,SAGA,aAHA,8CAKI,SANJ,WAMA,gLAMA,GALA,wBACA,mBACA,gBACA,wBAEA,iCACA,OADA,IACA,qCACA,IACA,kBAHA,+BANA,OAYA,6BAZA,SAaA,uDAbA,cAaA,EAbA,OAcA,4CACA,oGAfA,UAkBA,oDACA,6IACA,kEACA,4FAEA,4HAvBA,QA0BA,GARA,EAlBA,OA0BA,iCACA,OADA,IACA,qCACA,IACA,kBAHA,+BA1BA,GAgCA,cACA,sBACA,mBACA,oBACA,yDACA,kEACA,UACA,eAEA,kEACA,UACA,eAEA,mEACA,WACA,eAEA,kCACA,gEAlDA,kCAmDA,qBACA,kBApDA,QAmDA,EAnDA,OAsDA,KACA,uBACA,wBACA,yBACA,wBACA,gBACA,8BACA,GACA,QACA,uCAKA,uBACA,sDACA,aACA,gBAvEA,+CA6EIC,kBAnFJ,SAmFA,GACM,IAAN,IACA,oEACA,gCACM,MAAOC,EAAOC,EAAO,GAAK,EACxBA,EAASzC,KAAKa,MAAMe,KAAKf,MAAMe,KAAKc,KAEtC,OAAOD,EAAO,GAAKD,EAAOG,EAAO3C,KAAKa,MAAMe,KAAKf,MAAMe,KAAKc,KAAa,OAG7EE,MAAO,CACLxB,WAAY,SAAhB,KACMpB,KAAKe,OAAS8B,EACdC,QAAQC,IAAI/C,KAAKe,QACjBf,KAAKW,YAAY,CAAvB,gBACMX,KAAKgD,YAEPrB,UAAW,SAAf,KACM3B,KAAKoC,OAASS,EACd7C,KAAKW,YAAY,CAAvB,iBAEIe,OAAQ,SAAZ,KACM1B,KAAKmC,MAAQU,EACb7C,KAAKW,YAAY,CAAvB,mBC5K6W,I,YCOzWsC,EAAY,eACd,EACAnD,EACAkB,GACA,EACA,KACA,KACA,MAIa,aAAAiC,E","file":"js/chunk-2d20f951.c5f8c031.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('base-tf-selector',{attrs:{\"charts\":_vm.tfs,\"width\":_vm.width,\"height\":_vm.height,\"period\":_vm.period},on:{\"selected\":_vm.on_selected}}),_c('trading-vue',{ref:\"tradingVue\",attrs:{\"data\":_vm.chart,\"overlays\":_vm.overlays,\"width\":_vm.width,\"height\":_vm.height,\"title-txt\":_vm.symbol,\"toolbar\":true,\"tf\":_vm.period}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <base-tf-selector :charts=\"tfs\" :width=\"width\" :height=\"height\" v-on:selected=\"on_selected\" :period=\"period\">\n    </base-tf-selector>\n    <trading-vue :data=\"chart\" :overlays=\"overlays\" :width=\"width\" :height=\"height\" :title-txt=\"symbol\" :toolbar=\"true\" :tf=\"period\" ref=\"tradingVue\"></trading-vue>\n  </div>\n</template>\n<script>\nimport TradingVue from \"trading-vue-js\";\nimport Binance from 'binance-api-node'\nimport { DataCube } from \"trading-vue-js\";\nimport Overlays from 'tvjs-overlays'\n\nexport default {\n  name: 'graph',\n  components: { TradingVue },\n  props: {\n    symbolName: {\n      type: String,\n      default: 'BTCUSDT'\n    },\n    symbolPeriod: {\n      type: String,\n      default: '1m'\n    },\n    width: {\n      type: Number,\n      default: 500\n    },\n    height: {\n      type: Number,\n      default: 600\n    },\n    apiKey: {\n      type: String\n    },\n    apiSecret: {\n      type: String\n    }\n  },\n  async created() {\n\n  },\n  data() {\n    return {\n      overlays: Object.values(Overlays),\n      timer: '',\n      symbol: this.symbolName,\n      period: this.symbolPeriod,\n      tfs: {'1m': {}, '3m': {}, '5m': {}, '15m': {}, '1h': {}, '4h': {}},\n      chart: new DataCube({\n        chart: {\n          tf: '1m',\n          data: []\n        }\n      }),\n      wk: 1,\n      wss: [],\n      token: this.apiKey,\n      secret: this.apiSecret,\n      binance: new Binance({\n        apiKey: this.token,\n        apiSecret: this.secret\n      })\n    }\n  },\n  methods: {\n    async on_selected(tf) {\n      this.period = tf.name;\n      this.chart.set('chart.tf', tf.name);\n      await this.rerender();\n    },\n    async rerender() {\n      console.log('rerender');\n      this.binance = new Binance({\n        apiKey: this.apiKey,\n        apiSecret: this.apiSecret\n      })\n      if (this.wss.length > 0) {\n        for(const ws of this.wss) {\n          ws();\n          this.wss.splice(0, 1);\n        }\n      }\n      this.chart.set('chart.data', []);\n      let candleChartResults = await this.binance.candles({ symbol: this.symbol, interval: this.period });\n      this.chart.set('chart.data', candleChartResults.map((candle) => {\n        return [candle.openTime, Number(candle.open), Number(candle.high), Number(candle.low), Number(candle.close) , Number(candle.volume)];\n      }));\n\n      const ws = await this.binance.ws.candles(this.symbol, this.period, candle => {\n        if (this.chart.data.chart.data[this.chart.data.chart.data.length - 1].length && this.chart.data.chart.data[this.chart.data.chart.data.length - 1][0] === candle.startTime) {\n          this.chart.data.chart.data.splice(this.chart.data.chart.data.length - 1, 1,\n              [candle.startTime, Number(candle.open), Number(candle.high), Number(candle.low), Number(candle.close), Number(candle.volume)]);\n        } else {\n          this.chart.data.chart.data.push([candle.startTime, Number(candle.open), Number(candle.high), Number(candle.low), Number(candle.close), Number(candle.volume)]);\n        }\n      })\n      if (this.wss.length > 0) {\n        for(const ws of this.wss) {\n          ws();\n          this.wss.splice(0, 1);\n        }\n      }\n      this.wss.push(ws);\n      this.chart.del('Trades')\n      this.chart.del('EMA')\n      this.chart.del('Ichi')\n      this.chart.add('onchart', { name: 'Ichi', type: 'Ichi', data: [] });\n      this.chart.add('onchart', { name: 'EMA 33', type: 'EMA', data: [], settings: {\n          length: 33,\n          lineWidth: 1\n        }})\n      this.chart.add('onchart', { name: 'EMA 55', type: 'EMA', data: [], settings: {\n          length: 55,\n          lineWidth: 2\n        }})\n      this.chart.add('onchart', { name: 'EMA 120', type: 'EMA', data: [], settings: {\n          length: 120,\n          lineWidth: 3\n        }})\n      this.$refs.tradingVue.resetChart();\n      if (this.apiKey && this.apiKey.length > 0 && this.apiSecret && this.apiSecret.length > 0) {\n        const orders = await this.binance.allOrders({\n          symbol: this.symbol,\n        });\n        const ordersData = [];\n        orders.forEach((order) => {\n          if (order.status === 'FILLED') {\n            const orderType = order.side === 'BUY' ? 1 : 3\n            const total = order.cummulativeQuoteQty;\n            const qty = order.executedQty;\n            let data = this.findNearestCandle(order.time);\n            if (data) {\n              ordersData.push([\n                data[0], orderType, total / qty, total, data[1], data[2], data[3], data[4]\n              ])\n            }\n          }\n        });\n        this.chart.add('onchart', {\n          name: 'Trades', type: 'LongShortTrades', data: ordersData, settings: {\n            'z-index': 10,\n            'showLabel': true\n          }\n        })\n\n      }\n    },\n    findNearestCandle(time) {\n      let counter = 0;\n      const step = this.chart.data.chart.data[1][0] - this.chart.data.chart.data[0][0];\n      let candle = this.chart.data.chart.data[counter];\n      while (time - candle[0] > 0) {\n        candle = this.chart.data.chart.data[counter++];\n      }\n      return candle[0] - time < step ? this.chart.data.chart.data[counter++] : null;\n    }\n  },\n  watch: {\n    symbolName: function(newVal, oldVal) {\n      this.symbol = newVal;\n      console.log(this.symbol);\n      this.on_selected({i: 0, name: '1m'})\n      this.rerender();\n    },\n    apiSecret: function(newVal, oldVal) {\n      this.secret = newVal;\n      this.on_selected({i: 0, name: '1m'})\n    },\n    apiKey: function(newVal, oldVal) {\n      this.token = newVal;\n      this.on_selected({i: 0, name: '1m'})\n    }\n  }\n}\n\n</script>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Graph.vue?vue&type=template&id=21987f86&\"\nimport script from \"./Graph.vue?vue&type=script&lang=js&\"\nexport * from \"./Graph.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}